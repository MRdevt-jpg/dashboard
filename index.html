<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Mein Dashboard – Wochenplan & Finanzen</title>
  <meta name="theme-color" content="#0f172a" />
  <style>
    :root{
      --bg:#0f172a;--card:#111827;--muted:#1f2937;--text:#e5e7eb;--sub:#9ca3af;
      --blue:#38bdf8;--green:#22c55e;--red:#ef4444;
    }
    *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
    body{margin:0;background:linear-gradient(180deg,#0b1222,#0f172a);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}

    main{padding:22px 0 calc(env(safe-area-inset-bottom,0) + 100px)}
    .grid{display:grid;gap:14px}
    .cols-2{grid-template-columns:repeat(2,1fr)}
    @media(max-width:980px){.cols-2{grid-template-columns:1fr}}
    .card{background:var(--card);border:1px solid #1f2937;border-radius:16px;padding:14px}
    .card h2{margin:0 0 10px}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .grow{flex:1}
    .kpi{font-weight:700;font-size:26px}
    input,select,textarea{background:#0b1324;color:var(--text);border:1px solid #263248;border-radius:12px;padding:12px;font-size:16px}
    table{width:100%;border-collapse:separate;border-spacing:0 6px}
    thead th{font-weight:600;color:#93c5fd;text-align:left;font-size:12px}
    tbody td{background:#0b1324;border:1px solid #1e293b;padding:8px;vertical-align:top}
    .small{font-size:12px;color:#94a3b8}
    .slot{border-radius:10px;border:1px dashed #334155;padding:8px;margin-bottom:6px}
    .slot[data-type="Fix"]{border-color:#1d4ed8;background:#0b1224}
    .slot[data-type="Fokus"]{border-color:#16a34a;background:#071a12}
    .slot[data-type="Lernen"]{border-color:#a855f7;background:#140b24}
    .slot[data-type="Custom"]{border-color:#64748b;background:#0c1118}

    /* Bottom Navigation */
    .bottom-nav{
      position:fixed;left:12px;right:12px;bottom:12px;display:flex;gap:8px;justify-content:space-between;
      background:rgba(17,24,39,.92);backdrop-filter:blur(10px);
      border:1px solid #1f2937;border-radius:18px;
      padding:10px 12px calc(env(safe-area-inset-bottom,0) + 10px);
      box-shadow:0 10px 30px rgba(0,0,0,.45);
      z-index:20
    }
    .bottom-nav .tab{flex:1;min-height:48px;background:#0b1324;color:#e5e7eb;border:none;border-radius:12px;font-size:15px;font-weight:600;padding:12px 16px;cursor:pointer}
    .bottom-nav .tab.active{background:#0ea5e9;color:#082f49;box-shadow:inset 0 0 0 1px #38bdf8}

    /* Modal */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:50}
    .modal .box{background:var(--card);border:1px solid #1f2937;border-radius:16px;padding:14px;max-width:520px;width:94%}
  </style>
</head>
<body>
  <main class="wrap">
    <!-- DASHBOARD -->
    <section id="dashboard" class="tabpanel">
      <div class="card">
        <h2>Heute</h2>
        <div class="small" id="todayDate"></div>
        <div id="todayList"></div>
      </div>
    </section>

    <!-- WOCHENPLAN -->
    <section id="plan" class="tabpanel" hidden>
      <div class="card">
        <h2>Wochenplan</h2>
        <div class="row" style="margin:10px 0">
          <button class="btn" id="resetPlan">Woche leeren</button>
          <button class="btn" id="newEvent">Neuer Block</button>
        </div>
        <div id="planTable"></div>
      </div>
    </section>

    <!-- FINANZEN -->
    <section id="finanzen" class="tabpanel" hidden>
      <div class="grid cols-2">
        <div class="card">
          <h2>Gehalt & Fixkosten</h2>
          <div class="row">
            <input id="salaryInput" type="number" placeholder="Gehalt €" class="grow">
            <button id="saveSalary">Speichern</button>
          </div>
          <div class="row">
            <input id="fixName" class="grow" placeholder="Fixkosten (z. B. Miete)">
            <input id="fixAmount" type="number" placeholder="Betrag €">
            <button id="addFix">Hinzufügen</button>
          </div>
          <table><thead><tr><th>Name</th><th>Betrag</th><th></th></tr></thead><tbody id="fixTable"></tbody></table>
        </div>
        <div class="card">
          <h2>Einnahmen & Ausgaben</h2>
          <div class="row">
            <select id="txType"><option>Einnahme</option><option>Ausgabe</option></select>
            <input id="txCat" class="grow" placeholder="Kategorie">
          </div>
          <div class="row">
            <input id="txAmount" type="number" placeholder="Betrag €">
            <input id="txDate" type="date">
          </div>
          <div class="row">
            <button id="addTx">Hinzufügen</button>
            <button id="clearTx">Alle löschen</button>
          </div>
          <table><thead><tr><th>Datum</th><th>Typ</th><th>Kategorie</th><th>Betrag</th><th></th></tr></thead><tbody id="txTable"></tbody></table>
        </div>
        <div class="card" style="grid-column:1/-1">
          <h2>Übersicht</h2>
          <div class="row" style="gap:20px;flex-wrap:wrap">
            <div><div class="small">Gehalt</div><div class="kpi" id="mSalary">0 €</div></div>
            <div><div class="small">Fixkosten</div><div class="kpi" id="mFixed">0 €</div></div>
            <div><div class="small">Einnahmen</div><div class="kpi" id="mIn">0 €</div></div>
            <div><div class="small">Ausgaben</div><div class="kpi" id="mOut">0 €</div></div>
            <div><div class="small">Übrig</div><div class="kpi" id="mLeft">0 €</div></div>
          </div>
          <div class="small" id="mRate">Sparrate: 0%</div>
        </div>
      </div>
    </section>

    <!-- JOURNAL -->
    <section id="journal" class="tabpanel" hidden>
      <div class="card">
        <h2>Journal</h2>
        <textarea id="journalText" rows="6" class="grow" placeholder="Was war heute gut? Was schlecht?"></textarea>
        <button id="saveJournal">Speichern</button>
        <div id="journalEntries" style="margin-top:10px"></div>
      </div>
    </section>

    <!-- Modal für Wochenplan -->
    <div class="modal" id="eventModal" aria-modal="true" role="dialog">
      <div class="box">
        <h3>Block erstellen / bearbeiten</h3>
        <div class="row">
          <label>Tag<br><select id="evDay"></select></label>
          <label>Start<br><input id="evStart" type="time"></label>
          <label>Ende<br><input id="evEnd" type="time"></label>
          <label>Typ<br><select id="evType"><option>Custom</option><option>Fix</option><option>Fokus</option><option>Lernen</option></select></label>
        </div>
        <div><input id="evText" class="grow" placeholder="Block-Beschreibung"></div>
        <div class="row" style="justify-content:flex-end;gap:8px">
          <button id="evDelete">Löschen</button>
          <button id="evCancel">Abbrechen</button>
          <button id="evSave">Speichern</button>
        </div>
      </div>
    </div>
  </main>

  <!-- BOTTOM NAV -->
  <div class="bottom-nav">
    <button class="tab" data-tab="dashboard">Dashboard</button>
    <button class="tab" data-tab="plan">Wochenplan</button>
    <button class="tab" data-tab="finanzen">Finanzen</button>
    <button class="tab" data-tab="journal">Journal</button>
  </div>

  <script>
    const $ = s=>document.querySelector(s);
    const $$ = s=>Array.from(document.querySelectorAll(s));
    const store = { get:(k,d)=>{try{return JSON.parse(localStorage.getItem(k)) ?? d}catch{return d}}, set:(k,v)=>localStorage.setItem(k,JSON.stringify(v)) };
    const euro = n => (n||0).toLocaleString('de-DE',{style:'currency',currency:'EUR'});
    const days = ['Montag','Dienstag','Mittwoch','Donnerstag','Freitag','Samstag','Sonntag'];
    const pad = n=>String(n).padStart(2,'0');
    const hours = Array.from({length:17},(_,i)=>i+6);

    /* Tabs */
    function showTab(id){
      location.hash = id;
      $$('.tab').forEach(b=>b.classList.toggle('active', b.dataset.tab===id));
      $$('.tabpanel').forEach(s=>s.hidden = s.id!==id);
    }
    $$('.bottom-nav .tab').forEach(b=>b.addEventListener('click',()=>showTab(b.dataset.tab)));
    window.addEventListener('hashchange',()=>showTab((location.hash||'#dashboard').slice(1)));
    showTab((location.hash||'#dashboard').slice(1));

    /* Wochenplan */
    let plan = store.get('plan', {Montag:[],Dienstag:[],Mittwoch:[],Donnerstag:[],Freitag:[],Samstag:[],Sonntag:[]});
    const savePlan=()=>store.set('plan',plan);

    function buildPlanTable(){
      const container = $('#planTable'); container.innerHTML='';
      const table=document.createElement('table');
      const thead=document.createElement('thead'); const trh=document.createElement('tr');
      trh.appendChild(Object.assign(document.createElement('th'),{textContent:'Zeit'}));
      days.forEach(d=>trh.appendChild(Object.assign(document.createElement('th'),{textContent:d})));
      thead.appendChild(trh); table.appendChild(thead);
      const tbody=document.createElement('tbody');
      hours.forEach(h=>{
        const tr=document.createElement('tr');
        const label=`${pad(h)}:00`;
        const td0=document.createElement('td'); td0.textContent=label; td0.className='small'; tr.appendChild(td0);
        days.forEach(day=>{
          const td=document.createElement('td');
          const slot = (plan[day]||[]).find(([s,e])=> s<=label && e>label);
          if(slot){
            const el=document.createElement('div'); el.className='slot'; el.textContent=`${slot[2]} (${slot[0]}-${slot[1]})`;
            el.addEventListener('click',()=>openEventModal({day,start:slot[0],end:slot[1],type:slot[3],text:slot[2]}));
            td.appendChild(el);
          } else {
            td.textContent='—';
            td.addEventListener('click',()=>openEventModal({day,start:label,end:pad(h+1)+':00',type:'Custom',text:''}));
          }
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });
      table.appendChild(tbody);
      container.appendChild(table);
    }

    let editing=null;
    function openEventModal(obj){
      editing=obj;
      $('#evDay').innerHTML = days.map(d=>`<option ${d===obj.day?'selected':''}>${d}</option>`).join('');
      $('#evStart').value=obj.start; $('#evEnd').value=obj.end; $('#evType').value=obj.type; $('#evText').value=obj.text||'';
      $('#eventModal').style.display='flex';
    }
    function closeEvent(){ $('#eventModal').style.display='none'; editing=null; }
    $('#evCancel').addEventListener('click',closeEvent);
    $('#eventModal').addEventListener('click',e=>{ if(e.target.id==='eventModal') closeEvent(); });
    $('#evSave').addEventListener('click',()=>{
      const day=$('#evDay').value, s=$('#evStart').value, e=$('#evEnd').value, t=$('#evText').value.trim(), type=$('#evType').value;
      if(!t) return alert('Bitte Text eingeben.'); if(s>=e) return alert('Ende muss nach Start liegen.');
      plan[day]=plan[day].filter(([S,E])=> E<=s || S>=e );
      plan[day].push([s,e,t,type]); plan[day].sort((a,b)=>a[0].localeCompare(b[0]));
      savePlan(); buildPlanTable(); renderToday(); closeEvent();
    });
    $('#evDelete').addEventListener('click',()=>{
      if(!editing){ closeEvent(); return; }
      const {day,start,text}=editing;
      plan[day]=plan[day].filter(([s,,t])=>!(s===start && t===text));
      savePlan(); buildPlanTable(); renderToday(); closeEvent();
    });
    $('#resetPlan').addEventListener('click',()=>{ if(confirm('Alles löschen?')){ plan = {Montag:[],Dienstag:[],Mittwoch:[],Donnerstag:[],Freitag:[],Samstag:[],Sonntag:[]}; savePlan(); buildPlanTable(); renderToday(); } });
    $('#newEvent').addEventListener('click',()=>openEventModal({day:days[0],start:'06:00',end:'07:00',type:'Custom',text:''}));

    /* Dashboard */
    function renderToday(){
      const now=new Date(); const day=days[(now.getDay()+6)%7];
      $('#todayDate').textContent=now.toLocaleDateString('de-DE',{weekday:'long',day:'2-digit',month:'2-digit',year:'numeric'});
      const list=(plan[day]||[]).slice().sort((a,b)=>a[0].localeCompare(b[0]));
      $('#todayList').innerHTML=list.map(([s,e,t])=>`<div class="slot">${t} (${s}–${e})</div>`).join('');
    }

    /* Finanzen */
    let salary=store.get('salary',0);
    let fix=store.get('fix',[]);
    let tx=store.get('tx',[]);

    function renderFix(){
      const tb=$('#fixTable'); tb.innerHTML='';
      fix.forEach(item=>{
        const tr=document.createElement('tr');
        tr.innerHTML=`<td>${item.name}</td><td>${euro(item.amount)}</td>`;
        const td=document.createElement('td');
        const b=document.createElement('button'); b.textContent='×';
        b.onclick=()=>{ fix=fix.filter(f=>f.id!==item.id); store.set('fix',fix); renderFinance(); };
        td.appendChild(b); tr.appendChild(td); tb.appendChild(tr);
      });
    }
    $('#saveSalary').onclick=()=>{ salary=parseFloat($('#salaryInput').value||0); store.set('salary',salary); renderFinance(); };
    $('#addFix').onclick=()=>{
      const name=$('#fixName').value.trim(); const amount=parseFloat($('#fixAmount').value||0);
      if(!name||!amount) return;
      fix.push({id:crypto.randomUUID(),name,amount}); store.set('fix',fix);
      $('#fixName').value=''; $('#fixAmount').value=''; renderFinance();
    };

    $('#addTx').onclick=()=>{
      const type=$('#txType').value, cat=$('#txCat').value, amount=parseFloat($('#txAmount').value||0), date=$('#txDate').value||new Date().toISOString().slice(0,10);
      if(!amount) return;
      tx.push({id:crypto.randomUUID(),type,cat,amount,date}); store.set('tx',tx);
      $('#txCat').value=''; $('#txAmount').value=''; renderFinance();
    };
    $('#clearTx').onclick=()=>{ if(confirm('Alle löschen?
